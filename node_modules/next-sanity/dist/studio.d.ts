/// <reference types="react" />

import {ComponentProps} from 'react'
import {Config} from 'sanity'
import {DefaultTheme} from 'styled-components'
import {default as Document_2} from 'next/document'
import {DocumentContext} from 'next/document'
import {GlobalStyleComponent} from 'styled-components'
import Head from 'next/head'
import {MemoExoticComponent} from 'react'
import {ReactFragment} from 'react'
import {SingleWorkspace} from 'sanity'
import {StudioProps} from 'sanity'
import {StudioTheme} from 'sanity'
import {WorkspaceOptions} from 'sanity'

export declare type ConfigWithBasePath = SingleWorkspaceWithBasePath | WorkspaceOptions[]

export declare type ConfigWithTheme = SingleWorkspaceWithTheme | WorkspaceOptionsWithTheme[]

export declare function isWorkspaces(config: Config): config is WorkspaceOptions[]

export declare function isWorkspaceWithTheme(
  workspace: SingleWorkspace | WorkspaceOptions
): workspace is SingleWorkspaceWithTheme | WorkspaceOptionsWithTheme

export declare type MetaThemeColors = {
  themeColorLight: string
  themeColorDark: string
}

export declare const NextStudio: MemoExoticComponent<
  ({
    children,
    config,
    unstable__noGlobalStyle,
    unstable__noTailwindSvgFix,
    unstable__head,
    unstable__document_title,
    unstable__bg,
    unstable__fontFamily,
    unstable__noFavicons,
    unstable__noNoScript,
    ...props
  }: NextStudioProps) => JSX.Element
>

export declare const NextStudioGlobalStyle: GlobalStyleComponent<
  NextStudioGlobalStyleProps,
  DefaultTheme
>

export declare interface NextStudioGlobalStyleProps {
  fontFamily?: string
  bg?: string
  unstable__tailwindSvgFix?: boolean
}

export declare const NextStudioHead: MemoExoticComponent<
  ({
    children,
    themeColorDark,
    themeColorLight,
    title,
    favicons,
  }: NextStudioHeadProps) => JSX.Element
>

export declare interface NextStudioHeadProps extends Partial<MetaThemeColors> {
  children?: ComponentProps<typeof Head>['children']
  title?: string
  favicons?: boolean
}

export declare const NextStudioNoScript: () => JSX.Element

export declare interface NextStudioProps extends StudioProps {
  /**
   * Override how the Studio renders by passing children.
   * This is useful for advanced use cases where you're using StudioProvider and StudioLayout instead of Studio:
   * import {StudioProvider, StudioLayout} from 'sanity'
   * import {NextStudio} from 'next-sanity/studio'
   * <NextStudio config={config}>
   *   <StudioProvider config={config}>
   *     <CustomComponentThatUsesContextFromStudioProvider />
   *     <StudioLayout />
   *   </StudioProvider>
   * </NextStudio>
   */
  children?: React.ReactNode
  /**
   * Turns off the default global styling
   */
  unstable__noGlobalStyle?: boolean
  /**
   * Apply fix with SVG icon centering that happens if TailwindCSS is loaded, on by defautl
   */
  unstable__noTailwindSvgFix?: NextStudioGlobalStyleProps['unstable__tailwindSvgFix']
  /**
   * Add stuff to the head with next/head
   */
  unstable__head?: NextStudioHeadProps['children']
  /**
   * Sets the document title
   */
  unstable__document_title?: NextStudioHeadProps['title']
  /**
   * Sets the background color of <html>
   */
  unstable__bg?: NextStudioGlobalStyleProps['bg']
  /**
   * Sets the font-family of #__next
   */
  unstable__fontFamily?: NextStudioGlobalStyleProps['fontFamily']
  /**
   * Don't load the favicon meta tags
   */
  unstable__noFavicons?: boolean
  /**
   * Don't render the <noscript> tag
   */
  unstable__noNoScript?: boolean
}

/**
 * Usage, from a pages/_document.tsx file:
 * import {ServerStyleSheetDocument} from 'next-sanity/studio'
 *
 * export default class MyDocument extends ServerStyleSheetDocument {}
 *
 * To do extra stuff in getInitialProps:
 * import {ServerStyleSheetDocument} from 'next-sanity/studio'
 * import { type DocumentContext } from 'next/document'
 *
 * export default class MyDocument extends ServerStyleSheetDocument {
 *  static async getInitialProps(ctx: DocumentContext) {
 *    // You can still override renderPage:
 *    const originalRenderPage = ctx.renderPage
 *    ctx.renderPage = () => originalRenderPage({
 *       enhanceApp: (App) => (props) => <App {...props} />
 *    })
 *
 *    const initialProps = await ServerStyleSheetDocument.getInitialProps(ctx)
 *    const extraStyles = await getStyles()
 *    return {
 *      ...initialProps,
 *      styles: [initialProps.styles, extraStyles],
 *    }
 *  }
 * }
 */
export declare class ServerStyleSheetDocument extends Document_2 {
  static getInitialProps(ctx: DocumentContext): Promise<{
    styles: (JSX.Element | ReactFragment | undefined)[]
    html: string
    head?: (JSX.Element | null)[] | undefined
  }>
}

export declare type SingleWorkspaceWithBasePath = Omit<SingleWorkspace, 'basePath'> & {
  basePath: string
}

export declare type SingleWorkspaceWithTheme = Omit<SingleWorkspace, 'theme'> & WithTheme

export declare const useBackgroundColorsFromTheme: (theme: StudioTheme) => MetaThemeColors

/**
 * Parses the next route to determine the what the base path for Sanity Studio should be
 */
export declare function useBasePath(): string

/**
 * Apply the base path from next to the config, prefixing any defined base path
 */
export declare function useConfigWithBasePath(config: Config): ConfigWithBasePath

export declare const useTextFontFamilyFromTheme: (theme: StudioTheme) => string

export declare function useTheme(config: Config): StudioTheme

export declare type WithTheme = {
  theme: StudioTheme
}

export declare type WorkspaceOptionsWithTheme = Omit<WorkspaceOptions, 'theme'> & WithTheme

export declare interface WorkspaceWithBasePath extends Omit<WorkspaceOptions, 'basePath'> {
  basePath: string
}

export {}
